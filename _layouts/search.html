---
layout: default
---
<div class="search-layout sf-container">

  <header class="search-header">
    <h1 class="sf-h1">{{ page.title }}</h1>
    <p class="sf-text--large sf-text--muted">{{ page.subtitle | default: page.excerpt }}</p>
  </header>

  <form class="search-form" id="search-form" action="" onsubmit="return false;">
    <i class="ph-bold ph-magnifying-glass search-form__icon"></i>
    <input class="search-form__input" id="search-input" type="search" name="search" placeholder="e.g. Installation, project, ..." autocomplete="off" />
  </form>

  <div class="search-results" id="search-results-container">
    <!-- Search results will be dynamically injected here by JavaScript -->
  </div>

  <noscript>
    <div class="search-status">
      <i class="ph-bold ph-warning"></i>
      <p>Please enable JavaScript to use the search form.</p>
    </div>
  </noscript>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const endpoint = '{{ "/assets/search.json" | relative_url }}';
  let pages = [];

  const searchInput = document.getElementById('search-input');
  const resultsContainer = document.getElementById('search-results-container');

  // Fetch search data only once on page load
  fetch(endpoint)
    .then(blob => blob.json())
    .then(data => {
      // Clean up potential null entries from the JSON generation
      pages = data.filter(item => item !== null && typeof item === 'object');
    })
    .catch(err => {
      console.error('Error fetching search data:', err);
      resultsContainer.innerHTML = `
        <div class="search-status">
          <i class="ph-bold ph-x-circle"></i>
          <h3>Error Loading Search</h3>
          <p>The search index file could not be loaded. Please try again later.</p>
        </div>`;
    });

  function getIconForType(url) {
    if (url.includes('/docs/')) return 'ph-book-open';
    if (url.includes('/blog/') || url.match(/\/\d{4}\/\d{2}\/\d{2}\//)) return 'ph-article';
    if (url.includes('/projects/')) return 'ph-rocket-launch';
    if (url.includes('/products/')) return 'ph-storefront';
    return 'ph-file-text';
  }
  
  function findResults(termToMatch, data) {
    if (!termToMatch) return [];
    return data.filter(item => {
      const regex = new RegExp(termToMatch, 'gi');
      return item.title.match(regex) || item.content.match(regex);
    });
  }

  function displayResults() {
    const searchTerm = this.value;
    
    if (!searchTerm || searchTerm.length < 2) {
      resultsContainer.innerHTML = `
        <div class="search-status">
          <i class="ph-bold ph-keyboard"></i>
          <p>Start typing to see search results.</p>
        </div>`;
      return;
    }

    const resultsArray = findResults(searchTerm, pages);
    
    let html = '';
    if (resultsArray.length > 0) {
      html += `<div class="search-results__header"><h2 class="search-results__title">Results</h2><span class="search-results__count">${resultsArray.length} found</span></div>`;
      html += '<ul class="search-results__list">';
      html += resultsArray.map(item => {
        const icon = getIconForType(item.url);
        // Ensure excerpt is not null before using
        const excerpt = item.excerpt ? item.excerpt.substring(0, 150) + '...' : '';
        return `
          <li>
            <a href="${item.url}" class="search-result-item">
              <article>
                <i class="ph-bold ${icon} search-result-item__icon"></i>
                <div class="search-result-item__content">
                  <h3 class="search-result-item__title">${item.title}</h3>
                  <p class="search-result-item__excerpt">${excerpt}</p>
                </div>
              </article>
            </a>
          </li>`;
      }).join('');
      html += '</ul>';
    } else {
      html = `
        <div class="search-status">
          <i class="ph-bold ph-binoculars"></i>
          <h3>No results found</h3>
          <p>Try searching for a different term.</p>
        </div>`;
    }
    resultsContainer.innerHTML = html;
  }

  searchInput.addEventListener('keyup', displayResults);
  
  // Display initial state on page load
  displayResults.call({ value: '' });
});
</script>