/* ============================================================================
   COMPONENTS / PAGE.SCSS (V4 - THE DEFINITIVE FIX)
   This version provides comprehensive styling for all raw HTML elements
   inside the `.typeset` class to ensure containment and brand consistency.
   ============================================================================ */

/* --- 1. Page Header & Meta (Unchanged) --- */
.page-header { /* ... styles from previous version ... */ }
.breadcrumb { /* ... styles from previous version ... */ }
.page-header__meta { /* ... styles from previous version ... */ }


/* --- 2. Main Page Body & Grid --- */
.page-body-section {
  padding-block: var(--sf-8);
}


/* --- 3. THE CRITICAL FIX: Comprehensive Typesetting Styles --- */
.typeset {
  // Universal rules to prevent overflow
  overflow-wrap: break-word;
  > *:first-child { margin-top: 0; }
  > *:last-child { margin-bottom: 0; }
  
  // --- A. CONTENT CONTAINMENT FOR EMBEDS & MEDIA ---
  img, video, iframe, figure, .video {
    max-width: 100%;
    height: auto;
    margin-block: var(--sf-5);
    display: block; // Ensures margin auto works
  }

  // --- B. HEADINGS & PARAGRAPHS ---
  h1, h2, h3, h4, h5, h6 {
    margin: var(--sf-8) 0 var(--sf-4) 0;
    line-height: var(--sf-leading-tight);
    font-weight: 700;
  }
  h1 { font-size: var(--sf-text-3xl); }
  h2 { font-size: var(--sf-text-2xl); border-bottom: 1px solid var(--sf-line-2); padding-bottom: var(--sf-2); }
  h3 { font-size: var(--sf-text-xl); }
  p, ul, ol, blockquote { margin-bottom: var(--sf-5); }
  
  // --- C. CODE BLOCKS ---
  pre, .highlight {
    background-color: var(--sf-bg-1);
    border: 1px solid var(--sf-line-2);
    border-radius: var(--sf-radius-md);
    padding: var(--sf-4);
    font-size: var(--sf-text-sm);
    max-width: 100%;
    overflow-x: auto; // Allow internal scroll for wide code
  }
  code {
    font-family: var(--sf-font-mono);
    background-color: var(--sf-bg-1);
    border: 1px solid var(--sf-line-2);
    padding: .1em .3em;
    border-radius: var(--sf-radius-sm);
    font-size: 0.9em;
  }
  pre code { padding: 0; background: none; border: none; }

  // --- D. FIGURES & IMAGES (From your HTML) ---
  .figure {
    margin-block: var(--sf-6);
    &--center { margin-inline: auto; text-align: center; }
    &--left { float: left; margin-right: var(--sf-5); max-width: 50%; }
    &--right { float: right; margin-left: var(--sf-5); max-width: 50%; }
  }
  .caption {
    display: block;
    margin-top: var(--sf-2);
    font-size: var(--sf-text-sm);
    color: var(--sf-muted);
  }
  // Clearfix for floated figures
  p:has(+ .figure--left), p:has(+ .figure--right) {
    &::after { content: ""; display: table; clear: both; }
  }
  
  // --- E. FORMS (Crucial for styling the contact form) ---
  .form, form {
    margin-block: var(--sf-8);
    .fieldset { border: none; padding: 0; }
    .legend { font-weight: 600; margin-bottom: var(--sf-4); font-size: var(--sf-text-lg); }
    .label { display: block; font-weight: 500; margin-bottom: var(--sf-2); }
    .required { color: var(--sf-danger); }
    
    // Style inputs and textareas to match our button system
    .input, .textarea, input[type="text"], input[type="email"], textarea {
      @include control-base; // Use our mixin!
      display: block;
      width: 100%;
      margin-bottom: var(--sf-5);
      &:focus { @include focus-ring; }
    }
    .textarea, textarea { min-height: 150px; }
    
    // Style form buttons to use our .sf-btn class
    .button, input[type="submit"] {
      @extend .sf-btn;
      @extend .sf-btn--primary;
    }
  }

  // --- F. BUTTONS (Style the raw `<a>` tags with a .button class) ---
  a.button {
    @extend .sf-btn;
    @extend .sf-btn--secondary;
    text-decoration: none; // Remove underline from links styled as buttons
    margin-bottom: var(--sf-2);
  }
}

/* --- 4. Page Sidebar (Corrected & Finalized) --- */
.page-sidebar {
  display: flex;
  flex-direction: column;
  gap: var(--sf-6);
  margin-top: var(--sf-8); // Space on mobile when it stacks
  
  @include breakpoint(lg) {
    margin-top: 0;
    position: sticky;
    top: calc(var(--sf-nav-height) + var(--sf-4));
    align-self: start;
    // Set a max-height to allow internal scrolling if sidebar is too long
    max-height: calc(100vh - var(--sf-nav-height) - 60px);
    overflow-y: auto;
  }
}


/* --- 5. Sidebar Widgets (Unchanged) --- */
.toc-card { /* ... styles from previous version ... */ }
.quick-links-card { /* ... styles from previous version ... */ }
.ad-placeholder--sidebar-ad { /* ... styles from previous version ... */ }