/* ============================================================================
   PAGE / 404 FILM "The Lost Cloud"
   A 10-second animated film set in the Salesforce ecosystem.
   ============================================================================ */

// --- Keyframe Library ---
@keyframes cloud-float {
  from { transform: translateX(-100%); }
  to { transform: translateX(120vw); }
}
@keyframes cloud-glitch {
  0%, 100% { transform: skew(0); }
  25% { transform: skew(15deg, -5deg); }
  50% { transform: skew(-10deg, 10deg) scale(1.1); }
  75% { transform: skew(5deg, -15deg); }
}
@keyframes cloud-face-panic {
  from { content: '^_^'; }
  50% { content: 'o_O'; }
  to { content: 'x_x'; }
}
@keyframes cloud-error-flicker {
  from { opacity: 0; }
  50% { opacity: 1; }
  to { opacity: 0; }
}
@keyframes sky-darken {
  to { background-color: var(--sf-muted); }
}
@keyframes characters-enter {
  from { transform: translateY(100%); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}
@keyframes content-fade-in {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

// --- Main Stage ---
.film-404-sf {
  display: grid;
  place-items: center;
  height: 85vh;
  min-height: 600px;
  background-color: var(--sf-bg-1);
  overflow: hidden;

  &__stage {
    position: relative;
    width: 100%;
    height: 100%;
    
    .scene {
      position: absolute;
      inset: 0;
      opacity: 0; // All scenes are hidden by default
    }
  }
}

// --- Scene 1: Parallax Landscape ---
.scene--landscape {
  opacity: 1; // Always visible
  > div {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background-repeat: repeat-x;
    background-position: center bottom;
  }
  .landscape__sky {
    top: 0;
    background: linear-gradient(to bottom, var(--sf-accent), color-mix(in srgb, var(--sf-accent), white 60%));
    transition: background-color 1s ease;
  }
  // Simplified SVG shapes for buildings
  .landscape__buildings-back { height: 60%; background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M0 100 V 50 H 10 V 100 Z M 15 100 V 60 H 25 V 100 Z M 30 100 V 40 H 45 V 100 Z M 50 100 V 70 H 60 V 100 Z M 65 100 V 55 H 80 V 100 Z M 85 100 V 65 H 95 V 100 Z" fill="%23cfd7e0"/></svg>'); transform: scale(1.1); }
  .landscape__salesforce-tower { height: 80%; background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 200"><path d="M25 0 L 40 200 H 10 Z" fill="%233f4954"/></svg>'); background-size: contain; background-position: 55% bottom; }
  .landscape__buildings-front { height: 40%; background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M0 100 V 70 H 15 V 100 Z M 20 100 V 60 H 35 V 100 Z M 40 100 V 80 H 60 V 100 Z M 65 100 V 50 H 85 V 100 Z" fill="%238a96a3"/></svg>'); }
  .landscape__ground { height: 10%; background-color: var(--sf-fg-3); }
}

// --- The Lost Cloud Actor ---
.lost-cloud {
  position: absolute;
  top: 30%;
  left: 0;
  width: 120px;
  height: 80px;

  &__body {
    width: 100%;
    height: 100%;
    background-color: var(--sf-bg-hard);
    border-radius: 60px 60px 40px 40px / 40px 40px 30px 30px;
    box-shadow: var(--sf-shadow-lg);
    position: relative;
    &::before, &::after {
      content: '';
      position: absolute;
      background-color: var(--sf-bg-hard);
      border-radius: 50%;
    }
    &::before { width: 60px; height: 60px; top: -30px; left: 15px; }
    &::after { width: 80px; height: 80px; top: -40px; right: 5px; }
  }
  &__face {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-family: var(--sf-font-mono);
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--sf-fg);
    z-index: 2;
  }
  &__error {
    position: absolute;
    inset: 0;
    @include center;
    font-family: var(--sf-font-mono);
    font-size: 3rem;
    font-weight: 900;
    color: var(--sf-danger);
    z-index: 3;
    opacity: 0;
  }
}

// --- Scene 3: Characters ---
.scene--characters {
  display: flex;
  justify-content: center;
  align-items: flex-end;
  padding-bottom: 8%;
  gap: 2rem;
  .character {
    width: clamp(80px, 12vw, 120px);
    &--codey { transform: scaleX(-1); } // Make Codey face Astro
  }
}

// --- Scene 4: Content ---
.scene--content {
  @include center;
  flex-direction: column;
  text-align: center;
  background: linear-gradient(to top, var(--sf-bg-1) 30%, transparent);
  .content__title { /* ... */ }
  .content__subtitle { /* ... */ }
  .content__actions { /* ... */ }
}

// --- THE FILM DIRECTOR ---
#film-stage.is-playing {
  // --- Scene 1: The Cloud Floats (0s -> 2s) ---
  .scene--cloud-actor .lost-cloud {
    animation: cloud-float 2s linear forwards;
  }
  .scene--landscape .landscape__buildings-back { animation: cloud-float 2s linear forwards .05s; }
  .scene--landscape .landscape__salesforce-tower { animation: cloud-float 2s linear forwards .1s; }
  .scene--landscape .landscape__buildings-front { animation: cloud-float 2s linear forwards .15s; }

  // --- Scene 2: The Glitch (2s -> 4s) ---
  .scene--landscape .landscape__sky {
    animation: sky-darken 1s ease forwards;
    animation-delay: 2s;
  }
  .lost-cloud {
    animation: cloud-float 2s linear forwards, cloud-glitch 0.2s steps(4) infinite;
    animation-delay: 0s, 2s;
  }
  .lost-cloud__face {
    animation: cloud-face-panic 1s steps(2, end) forwards;
    animation-delay: 2s;
  }
  .lost-cloud__error {
    animation: cloud-error-flicker 0.5s steps(2, end) infinite;
    animation-delay: 2.2s;
  }

  // --- Scene 3: Characters Appear (4s -> 7s) ---
  .scene--characters {
    animation: characters-enter 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    animation-delay: 4s;
  }

  // --- Scene 4: Content Appears (7s -> 10s) ---
  .scene--content {
    animation: content-fade-in 1s ease forwards;
    animation-delay: 7s;
  }
  
  // --- Cleanup for Loop ---
  // Fade out all scenes except the landscape at the end.
  .scene--cloud-actor, .scene--characters, .scene--content {
    animation-fill-mode: forwards;
    animation-name: fade-out;
    animation-duration: 0.5s;
    animation-delay: 9.5s;
  }
  @keyframes fade-out { to { opacity: 0 !important; } }
}