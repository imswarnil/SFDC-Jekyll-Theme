/* ============================================================================
   PAGE / 404 "The Trailblazer's Lost Compass"
   A beautiful, story-driven, and reliable animated 404 page.
   ============================================================================ */

// --- Keyframe Library ---
@keyframes compass-spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(1080deg); } // Spin 3 full times
}

@keyframes compass-glitch {
  0%, 100% { opacity: 0; transform: scale(0.5); }
  10%, 90% { opacity: 1; transform: scale(1.5); }
  25% { transform: scale(1.5) skew(-15deg); }
  50% { opacity: 0.5; }
  75% { transform: scale(1.5) skew(15deg); }
}

@keyframes needle-droop {
  to { transform: rotate(160deg); }
}

@keyframes astro-slide-in {
  from { transform: translateX(150%) rotate(20deg); }
  to { transform: translateX(0) rotate(0); }
}

@keyframes content-fade-in {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

// --- Main Layout ---
.page-404-compass {
  display: grid;
  place-items: center;
  min-height: 80vh;
  padding: var(--sf-4);
  background-color: var(--sf-bg-1);
  overflow: hidden;
  text-align: center;
}

// --- The Scene ---
.compass-scene {
  position: relative;
  margin-bottom: var(--sf-6);
  // Add a wrapper to contain Astro
  width: clamp(250px, 50vw, 350px);
  height: clamp(250px, 50vw, 350px);
}

.compass {
  position: absolute;
  inset: 0;
  border-radius: 50%;
  background-color: var(--sf-bg-2);
  box-shadow: var(--sf-shadow-lg), inset 0 10px 20px rgba(0,0,0,0.1);
  
  // -- The Rings --
  &__ring {
    position: absolute;
    inset: 0;
    border-radius: 50%;
    border: 2px solid var(--sf-line-1);
    &--outer { inset: 5%; }
    &--inner { inset: 10%; border-style: dashed; }
  }

  // -- The Face --
  &__face {
    position: absolute;
    inset: 12%;
    border-radius: 50%;
    .compass__marker {
      position: absolute;
      font-family: var(--sf-font-mono);
      font-weight: 700;
      color: var(--sf-muted);
      &--n { top: 5%; left: 50%; transform: translateX(-50%); }
      &--e { top: 50%; right: 5%; transform: translateY(-50%); }
      &--s { bottom: 5%; left: 50%; transform: translateX(-50%); }
      &--w { top: 50%; left: 5%; transform: translateY(-50%); }
    }
  }

  // -- The Needle --
  &__needle {
    position: absolute;
    inset: 20%;
    // The animation happens here!
    animation: compass-spin 2s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards,
               needle-droop 1s ease-in-out forwards 3s;
  }
  .needle__pointer {
    width: 0;
    height: 0;
    border-left: 10px solid transparent;
    border-right: 10px solid transparent;
    border-bottom: 50% solid var(--sf-brand);
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
  }
  .needle__tail {
    width: 0;
    height: 0;
    border-left: 10px solid transparent;
    border-right: 10px solid transparent;
    border-top: 50% solid var(--sf-fg-3);
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
  }
  .needle__pivot {
    width: 15px;
    height: 15px;
    background-color: var(--sf-bg-hard);
    border: 2px solid var(--sf-fg-3);
    border-radius: 50%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10;
  }

  // -- The Glitch Text --
  &__glitch-text {
    position: absolute;
    inset: 0;
    @include center;
    font-family: var(--sf-font-mono);
    font-size: clamp(4rem, 12vw, 6rem);
    font-weight: 900;
    color: var(--sf-danger);
    text-shadow: 0 0 10px var(--sf-danger);
    opacity: 0;
    animation: compass-glitch 0.5s steps(4) infinite;
    animation-delay: 2s; // Start after spinning
    animation-play-state: paused; // Will be activated by the master animation
  }
  
  // --- Master Animation Trigger ---
  // When the scene is active, play the glitch text animation
  .compass-scene:hover &,
  body:not(:hover) & { // A trick to get it to run on page load
    .compass__glitch-text {
      animation-play-state: running;
    }
  }
}

// --- The Astro Character ---
.compass-scene__astro {
  position: absolute;
  bottom: -20px;
  right: -30px;
  width: clamp(100px, 20vw, 150px);
  transform: translateX(150%);
  z-index: 20;
  animation: astro-slide-in 1s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
  animation-delay: 4s; // Astro appears after the compass has drooped
  svg { filter: drop-shadow(-10px 10px 15px rgba(0,0,0,0.15)); }
}

// --- The Final Content ---
.compass-content {
  opacity: 0;
  animation: content-fade-in 1s ease forwards;
  animation-delay: 4.5s; // Fades in just after Astro appears

  &__title {
    font-size: var(--sf-text-2xl);
    font-weight: 700;
    margin-bottom: var(--sf-2);
  }
  &__subtitle {
    color: var(--sf-muted);
    max-width: 50ch;
    margin-inline: auto;
    margin-bottom: var(--sf-5);
  }
  &__actions {
    @include cluster($gap: var(--sf-3), $justify: center);
    .sf-btn { /* (Uses the self-contained button style from the previous answer) */ }
  }
}