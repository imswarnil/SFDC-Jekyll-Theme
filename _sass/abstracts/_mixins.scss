/* ============================================================================
   ABSTRACTS / MIXINS (DEFINITIVE & CORRECTED VERSION)
   A powerful and well-documented library of reusable SCSS functions.
   - Restores the 4-argument `cluster` mixin to fix the build error.
   - Includes enhanced responsive mixins and new helpers.
   ============================================================================ */
@use "sass:map";

/* ============================================================================
   1. RESPONSIVE DESIGN
   ============================================================================ */

/**
 * Applies styles from a specific breakpoint and up (mobile-first).
 * @param {string} $point - The breakpoint name (e.g., 'sm', 'md', 'lg').
 * @example @include breakpoint(md) { ...styles for medium screens and up... }
 */
@mixin breakpoint($point) {
  // This now uses the modern $breakpoints map from _variables.scss
  @if map.has-key($breakpoints, $point) {
    @media (min-width: map.get($breakpoints, $point)) {
      @content;
    }
  } @else {
    @warn "Breakpoint '#{$point}' not found in the $breakpoints map in _variables.scss.";
  }
}

/**
 * Applies styles below a specific breakpoint (desktop-first).
 * @param {string} $point - The breakpoint name.
 * @example @include breakpoint-down(md) { ...styles for screens smaller than 'md'... }
 */
@mixin breakpoint-down($point) {
  @if map.has-key($breakpoints, $point) {
    @media (max-width: map.get($breakpoints, $point) - 0.02px) {
      @content;
    }
  } @else {
    @warn "Breakpoint '#{$point}' not found in $breakpoints map.";
  }
}


/* ============================================================================
   2. TYPOGRAPHY HELPERS
   ============================================================================ */

/**
 * Enables smoother font rendering on most browsers.
 * @example @include antialiased;
 */
@mixin antialiased {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/**
 * Truncates text to a specific number of lines with an ellipsis.
 * @param {number} $lines - The number of lines to show.
 * @example @include truncate(2);
 */
@mixin truncate($lines: 1) {
  @if $lines == 1 {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  } @else {
    display: -webkit-box;
    -webkit-line-clamp: $lines;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
}


/* ============================================================================
   3. ACCESSIBILITY & INTERACTION
   ============================================================================ */

/**
 * Visually hides an element but keeps it accessible to screen readers.
 * @example .skip-link { @include sr-only; }
 */
@mixin sr-only {
  position: absolute !important;
  width: 1px; height: 1px;
  padding: 0; margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/**
 * Reverses sr-only, making an element visible again.
 */
@mixin not-sr-only {
  position: static; width: auto; height: auto;
  padding: 0; margin: 0;
  overflow: visible; clip: auto;
  white-space: normal;
}

/**
 * Applies a consistent, accessible focus ring using design tokens.
 * @example button { @include focus-visible; }
 */
@mixin focus-ring {
  outline: none;
  box-shadow: var(--focus-ring);
  border-radius: 2px;
}
@mixin focus-visible {
  &:focus-visible {
    @include focus-ring;
  }
}

/**
 * Restricts hover effects to devices that can truly hover (not touchscreens).
 * @example .card { @include hover { background-color: blue; } }
 */
@mixin hover {
  @media (hover: hover) and (pointer: fine) {
    &:hover {
      @content;
    }
  }
}

/**
 * Guards animations for users who prefer reduced motion.
 * @example @include motion-safe { transition: transform .3s ease; }
 */
@mixin motion-safe {
  @media (prefers-reduced-motion: no-preference) {
    @content;
  }
}
@mixin motion-reduce {
  @media (prefers-reduced-motion: reduce) {
    @content;
  }
}


/* ============================================================================
   4. LAYOUT PRIMITIVES
   ============================================================================ */

/**
 * Centers a child element within a parent using flexbox.
 * @param {string} $axis - 'x', 'y', or 'both'.
 * @example .parent { @include center; }
 */
@mixin center($axis: 'both') {
  display: flex;
  @if $axis == 'both' {
    align-items: center;
    justify-content: center;
  } @else if $axis == 'x' {
    justify-content: center;
  } @else if $axis == 'y' {
    align-items: center;
  }
}

/**
 * Stacks items vertically with consistent spacing.
 * @example .form-fields { @include stack; }
 */
@mixin stack($gap: var(--sf-space-4)) {
  display: flex;
  flex-direction: column;
  gap: $gap;
}

/**
 * THE CORRECTED MIXIN
 * Creates a horizontal list of items with consistent spacing and wrapping.
 * @example .card-tags { @include cluster(var(--sf-space-2), center, flex-start, wrap); }
 */
@mixin cluster($gap: var(--sf-space-3), $align: center, $justify: flex-start, $wrap: wrap) {
  display: flex;
  flex-wrap: $wrap;
  align-items: $align;
  justify-content: $justify;
  gap: $gap;
}


/* ============================================================================
   5. EFFECTS & RESETS
   ============================================================================ */

/**
 * Applies a consistent box-shadow based on the elevation token system.
 * @param {string} $level - '1', '2', '3', or '4'.
 * @example .card { @include elevation('2'); }
 */
@mixin elevation($level: '2') {
  box-shadow: map-get($elevations, $level);
}

/**
 * Creates a fixed aspect ratio box that works even in older browsers.
 * @param {number} $width - The width ratio.
 * @param {number} $height - The height ratio.
 * @example .card__image { @include aspect-ratio(16, 9); }
 */
@mixin aspect-ratio($width, $height) {
  aspect-ratio: #{$width} / #{$height};
  @supports not (aspect-ratio: #{$width} / #{$height}) {
    position: relative;
    &::before {
      content: '';
      display: block;
      padding-top: calc(#{$height} / #{$width} * 100%);
    }
    > * {
      position: absolute;
      inset: 0;
    }
  }
}

/**
 * Resets the default browser styles for buttons and inputs.
 * @example button { @include button-reset; }
 */
@mixin button-reset {
  padding: 0;
  border: none;
  font: inherit;
  color: inherit;
  background-color: transparent;
  cursor: pointer;
}
@mixin input-reset {
  appearance: none;
  background: none;
  border: 0;
  padding: 0;
  font: inherit;
  color: inherit;
}

/**
 * A base style for form controls like inputs and textareas.
 */
@mixin control-base {
  min-height: var(--input-height);
  padding-inline: var(--input-padding-x);
  border-radius: var(--input-radius);
  background: var(--input-bg);
  color: var(--input-fg);
  border: 1px solid var(--input-border);
}


/* ============================================================================
   6. ICONS & MEDIA
   ============================================================================ */
   
/**
 * Sets a fixed square size for an icon.
 * @param {string} $size - The desired size (e.g., var(--sf-icon-md)).
 */
@mixin icon-size($size: var(--sf-icon-md)) {
  width: $size;
  height: $size;
  flex-shrink: 0;
}

/**
 * Makes an image cover its container, often used with aspect-ratio.
 */
@mixin media-cover {
  width: 100%;
  height: 100%;
  object-fit: cover;
}