<!-- ============================================================================
_includes/navbar.html (Premium Animation Edition - Complete)
============================================================================ -->

<header class="sf-header">
<div class="sf-container sf-header__bar">

<a href="{{ '/' | relative_url }}" class="sf-brand">
 <img src="{{ site.baseurl }}{{ site.logo }}" alt="{{ site.title }} Logo" class="sf-brand__image-logo">
 <div class="sf-brand__text">
   <div class="sf-h5 sf-mb-0 sf-brand-title">{{ site.title }}</div>
   <div class="sf-text--small">{{ site.job_title }}</div>
 </div>
</a>

<nav class="sf-nav--desktop" aria-label="Main navigation">
 {% for item in site.navigation_header %}
   <a href="{{ item.url | relative_url }}" class="sf-nav--desktop__link {% if page.url == item.url %}is-active{% endif %}">
     {% if item.icon %}<i class="ph-bold ph-{{ item.icon }}"></i>{% endif %}
     <span>{{ item.title }}</span>
   </a>
 {% endfor %}
</nav>

<div class="sf-header__actions">
 <button class="sf-header__action-btn" aria-label="Open Search" data-toggle="search-panel">
   <i class="ph-bold ph-magnifying-glass"></i>
 </button>
 <a href="https://github.com/your-username" class="sf-header__action-btn" aria-label="GitHub Profile" target="_blank" rel="noopener noreferrer">
   <i class="ph-bold ph-github-logo"></i>
 </a>
 <button class="sf-header__action-btn sf-theme-switcher" aria-label="Toggle theme">
   <i class="ph-bold ph-sun"></i>
   <i class="ph-bold ph-moon"></i>
 </button>
 <button class="sf-nav-toggle" aria-label="Toggle navigation" data-toggle="nav-panel">
   <span></span><span></span><span></span>
 </button>
</div>
</div>
</header>

<!-- Search Panel (Modal) -->
<div class="sf-search-panel" id="search-panel">
<div class="sf-container">
<div class="sf-search-panel__form">
 <i class="ph-bold ph-magnifying-glass" style="font-size: 1.5rem; color: var(--sf-muted);"></i>
 <input type="search" id="sf-search-input" class="sf-search-panel__input" placeholder="Search..." autocomplete="off" />
 <button type="button" class="sf-header__action-btn" aria-label="Close Search" data-toggle="search-panel">
   <i class="ph-bold ph-x"></i>
 </button>
</div>
</div>
</div>

<!-- Search Results Container (Separate for better layout control) -->
<div class="sf-search-results-wrapper" id="sf-search-results-wrapper">
<ul class="sf-search-results" id="sf-search-results-list">
   <!-- JS will populate this -->
</ul>
</div>

<!-- Mobile Navigation Panel (Modal) -->
<div class="sf-nav-panel" id="nav-panel">
<div class="sf-nav-panel__backdrop" data-toggle="nav-panel"></div>
<div class="sf-nav-panel__content">
<header class="sf-nav-panel__header">
 <span>Navigation</span>
 <button class="sf-header__action-btn" aria-label="Close navigation" data-toggle="nav-panel">
   <i class="ph-bold ph-x"></i>
 </button>
</header>
<nav>
 <ul class="sf-nav-panel__list">
   {% for item in site.navigation_header %}
     <li>
       <a href="{{ item.url | relative_url }}" class="sf-nav-panel__link {% if page.url == item.url %}is-active{% endif %}" data-toggle="nav-panel">
         {% if item.icon %}<i class="ph-bold ph-{{ item.icon }}"></i>{% endif %}
         <span>{{ item.title }}</span>
       </a>
     </li>
   {% endfor %}
 </ul>
</nav>
</div>
</div>

<!-- Self-contained JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', () => {
const htmlEl = document.documentElement;

// --- Panel Toggling with Click Point Animation ---
const navPanel = document.getElementById('nav-panel');
const navContent = navPanel ? navPanel.querySelector('.sf-nav-panel__content') : null;
const searchPanel = document.getElementById('search-panel');
const searchResultsWrapper = document.getElementById('sf-search-results-wrapper');

document.querySelectorAll('[data-toggle]').forEach(toggle => {
 toggle.addEventListener('click', (event) => {
   const targetPanel = document.getElementById(toggle.getAttribute('data-toggle'));
   if (!targetPanel) return;

   if (targetPanel.id === 'nav-panel' && navContent) {
     const clickX = event.clientX;
     const clickY = event.clientY;
     navContent.style.setProperty('--click-origin', `${clickX}px ${clickY}px`);
   }

   const isOpen = targetPanel.classList.toggle('is-open');

   if (targetPanel.id === 'nav-panel') {
     htmlEl.style.overflow = isOpen ? 'hidden' : '';
     document.querySelector('.sf-nav-toggle').classList.toggle('is-active', isOpen);
   }
   if (targetPanel.id === 'search-panel') {
       searchResultsWrapper.classList.toggle('is-active', isOpen);
       if (isOpen) {
           setTimeout(() => targetPanel.querySelector('input[type="search"]').focus(), 500);
       }
   }
 });
});

// --- Theme Switching with Body Class for Animation ---
const themeSwitcher = document.querySelector('.sf-theme-switcher');
const setTheme = theme => {
 document.body.classList.add('theme-transitioning');
 htmlEl.setAttribute('data-theme', theme);
 localStorage.setItem('theme', theme);
 setTimeout(() => document.body.classList.remove('theme-transitioning'), 500);
};
const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
setTheme(savedTheme);
themeSwitcher.addEventListener('click', () => setTheme(htmlEl.getAttribute('data-theme') === 'dark' ? 'light' : 'dark'));

// --- Live Search ---
const searchInput = document.getElementById('sf-search-input');
const resultsList = document.getElementById('sf-search-results-list');
let pages = [];

fetch('{{ "/assets/search.json" | relative_url }}')
 .then(res => res.json())
 .then(data => pages.push(...data));

searchInput.addEventListener('keyup', function() {
 const term = this.value.trim();
 if (!term) {
   resultsList.innerHTML = '';
   return;
 }
 const results = pages.filter(p => {
   const regex = new RegExp(term, 'gi');
   return p.title.match(regex) || p.content.match(regex);
 });
 
 if (results.length > 0) {
   resultsList.innerHTML = results.map(item => `
     <li class="sf-search-result">
       <a href="${item.url}" class="sf-search-result__link">
         <h4 class="sf-search-result__title">${item.title}</h4>
         <p class="sf-search-result__excerpt">${item.excerpt}</p>
       </a>
     </li>`).join('');
 } else {
   resultsList.innerHTML = `<div class="sf-search-panel__no-results">No results found for "${term}"</div>`;
 }
});

// UX Improvement: Clear search on close
document.querySelectorAll('[data-toggle="search-panel"]').forEach(btn => {
 btn.addEventListener('click', () => {
   if (searchPanel && searchPanel.classList.contains('is-open')) {
       setTimeout(() => {
           searchInput.value = '';
           resultsList.innerHTML = '';
       }, 500);
   }
 });
});
});
</script>