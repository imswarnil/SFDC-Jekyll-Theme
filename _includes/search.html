
<!-- DYNAMIC PAGE HEADER -->
<header class="sf-page-header">
  <div class="sf-container">
    <div class="search-header-grid">
      <div class="search-header__text">
        <h1 class="sf-h1 sf-page-header__title">{{ page.title }}</h1>
        <p class="sf-text--large sf-page-header__subtitle">{{ page.subtitle }}</p>
      </div>
      <div class="trending-topics">
        <h2 class="trending-topics__title">Trending Topics:</h2>
        <div class="trending-topics__list">
          <a href="#" class="sf-badge sf-badge--brand" data-search-term="Salesforce">Salesforce</a>
          <a href="#" class="sf-badge" data-search-term="LWC">LWC</a>
          <a href="#" class="sf-badge" data-search-term="Filmmaking">Filmmaking</a>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- MAIN SEARCH LAYOUT -->
<div class="sf-container" style="padding: var(--sf-8) 0;">
  <div class="search-layout">

    <!-- Primary Content Column (Left) -->
    <main class="search-main">
      <form class="search-input-wrapper" action="" role="search" onsubmit="return false;">
        <label for="search-input" class="sf-sr-only">Search term:</label>
        <i class="ph-bold ph-magnifying-glass"></i>
        <input class="sf-input page-search-input" id="search-input" type="search" name="search" placeholder="Search for anything..." autocomplete="off" />
      </form>
      <ul class="search-results-list" id="results-list">
        <!-- Live search results are injected here -->
      </ul>
    </main>

    <!-- Sidebar Column (Right) -->
    <aside class="search-sidebar">
      
      <div class="sf-card">
        <header class="sf-card__header">
          <h3 class="sf-h4">Filter by Type</h3>
        </header>
        <div class="sf-card__body">
          <ul class="sf-list">
            <li class="sf-list__item"><label class="sf-check"><input type="radio" name="typeFilter" value="all" checked> <span class="sf-check__box"></span> <span>All Results</span></label></li>
            <li class="sf-list__item"><label class="sf-check"><input type="radio" name="typeFilter" value="post"> <span class="sf-check__box"></span> <span>Blog Posts</span></label></li>
            <li class="sf-list__item"><label class="sf-check"><input type="radio" name="typeFilter" value="page"> <span class="sf-check__box"></span> <span>Pages</span></label></li>
          </ul>
        </div>
      </div>
      
      <div class="sf-alert sf-alert--info instant-answer-card" id="instant-answer-card">
        <div>
          <h4 class="sf-h5">Instant Answer</h4>
          <p class="instant-answer-card__text" id="instant-answer-text"></p>
          <a href="#" class="instant-answer-card__source" id="instant-answer-source"></a>
        </div>
      </div>

    </aside>
  </div>
</div>

<!-- YOUR ORIGINAL JAVASCRIPT (MODIFIED TO WORK WITH NEW HTML) -->
<script type="text/javascript" src="{{ "/assets/scripts/fetch.js" | relative_url }}"></script>
<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', () => {
    const endpoint = '{{ "/assets/search.json" | relative_url }}';
    const pages = [];

    const searchInput = document.getElementById('search-input');
    const resultsList = document.getElementById('results-list');
    const typeFilters = document.querySelectorAll('input[name="typeFilter"]');
    const trendingLinks = document.querySelectorAll('[data-search-term]');
    
    const instantAnswerCard = document.getElementById('instant-answer-card');
    const instantAnswerText = document.getElementById('instant-answer-text');
    const instantAnswerSource = document.getElementById('instant-answer-source');

    fetch(endpoint).then(blob => blob.json()).then(data => pages.push(...data));

    const performSearch = () => {
      const searchTerm = searchInput.value.trim();
      const selectedType = document.querySelector('input[name="typeFilter"]:checked').value;

      if (searchTerm === '') {
        resultsList.innerHTML = '';
        instantAnswerCard.style.display = 'none';
        return;
      }
      
      const regex = new RegExp(searchTerm, 'gi');
      
      let allResults = pages.filter(item => {
        return item.title.match(regex) || item.content.match(regex);
      });

      let filteredResults = allResults;
      if (selectedType !== 'all') {
        filteredResults = allResults.filter(item => {
          return selectedType === 'post' ? item.url.includes('/blog/') : !item.url.includes('/blog/');
        });
      }
      
      displayResults(filteredResults, searchTerm);
      findInstantAnswer(allResults, regex);
    };
    
    const displayResults = (resultsArray, searchTerm) => {
      if (resultsArray.length === 0) {
        resultsList.innerHTML = `<li><div class="sf-tile search-no-results"><i class="ph-bold ph-files"></i><h3 class="sf-h3">No Results Found</h3><p>Sorry, we couldn't find anything matching "${searchTerm}".</p></div></li>`;
        return;
      }
      const highlight = (text, term) => text ? text.replace(new RegExp(term, 'gi'), (match) => `<mark>${match}</mark>`) : '';
      
      resultsList.innerHTML = resultsArray.map(item => {
        const isPost = item.url.includes('/blog/');
        const icon = isPost ? 'ph-newspaper' : 'ph-file-text';
        const excerpt = item.excerpt ? highlight(item.excerpt.replace(/<[^>]*>?/gm, '').substring(0, 150) + '...', searchTerm) : 'No description available.';
        const urlType = isPost ? "Blog Post" : "Page";
        
        return `
          <li>
            <a href="${item.url}" class="sf-card search-result-card">
              <div class="sf-card__body">
                <header class="search-result-card__header">
                  <i class="ph-bold ${icon} search-result-card__icon"></i>
                  <div>
                    <h2 class="sf-h4 search-result-card__title">${highlight(item.title, searchTerm)}</h2>
                  </div>
                </header>
                <p class="search-result-card__excerpt">${excerpt}</p>
              </div>
              <footer class="sf-card__footer">${urlType} â€¢ ${item.url}</footer>
            </a>
          </li>`;
      }).join('');
    };
    
    const findInstantAnswer = (results, regex) => {
        for (const item of results) {
            const match = item.content.match(new RegExp(`[^.?!]*${regex.source}[^.?!]*[.?!]`, 'i'));
            if (match) {
                instantAnswerText.innerHTML = match[0].replace(regex, (m) => `<mark>${m}</mark>`);
                instantAnswerSource.textContent = `Source: ${item.title}`;
                instantAnswerSource.href = item.url;
                instantAnswerCard.style.display = 'flex'; // Use flex for alert styling
                return;
            }
        }
        instantAnswerCard.style.display = 'none';
    };

    searchInput.addEventListener('keyup', performSearch);
    typeFilters.forEach(filter => filter.addEventListener('change', performSearch));
    trendingLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        searchInput.value = link.getAttribute('data-search-term');
        performSearch();
        searchInput.focus();
      });
    });

    searchInput.closest('form').addEventListener('submit', e => e.preventDefault());
  });
</script>

<noscript>
  <div class="sf-alert sf-alert--warning">Please enable JavaScript to use the search form.</div>
</noscript>